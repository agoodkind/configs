input {
  # Syslog input for OPNsense logs
  udp {
    type => "syslog"
    host => "::"
    port => 5140
  }

  # HTTP input for JSON data
  http {
    host => "::"
    port => 5044
    codec => json {
      target => "[document]"
    }
    additional_codecs => {}
  }

  # HTTP poller for OPNsense metrics - Gateway status (dpinger)
  http_poller {
    urls => {
      gateway_status => {
        method => get
        url => "${opnsense_url}/api/routes/gateway/status"
        headers => {
          Accept => "application/json"
        }
        auth => {
          user => "${opnsense_api_key}"
          password => "${opnsense_api_secret}"
        }
      }
    }
    request_timeout => 10
    schedule => { every => "1s" }
    codec => "json"
    type => "opnsense_gateway_metrics"
    tags => ["metrics", "opnsense", "gateway"]
  }

  # HTTP poller for OPNsense metrics - System resources (CPU/RAM)
  http_poller {
    urls => {
      system_resources => {
        method => get
        url => "${opnsense_url}/api/diagnostics/system/systemResources"
        headers => {
          Accept => "application/json"
        }
        auth => {
          user => "${opnsense_api_key}"
          password => "${opnsense_api_secret}"
        }
      }
    }
    request_timeout => 5
    schedule => { every => "5s" }
    codec => "json"
    type => "opnsense_system_metrics"
    tags => ["metrics", "opnsense", "system"]
  }

  # HTTP poller for OPNsense metrics - System load/uptime
  http_poller {
    urls => {
      system_time => {
        method => get
        url => "${opnsense_url}/api/diagnostics/system/systemTime"
        headers => {
          Accept => "application/json"
        }
        auth => {
          user => "${opnsense_api_key}"
          password => "${opnsense_api_secret}"
        }
      }
    }
    request_timeout => 5
    schedule => { every => "5s" }
    codec => "json"
    type => "opnsense_load_metrics"
    tags => ["metrics", "opnsense", "load"]
  }

  # HTTP poller for OPNsense metrics - Interface statistics (in/out)
  http_poller {
    urls => {
      interface_stats => {
        method => get
        url => "${opnsense_url}/api/diagnostics/interface/getInterfaceStatistics"
        headers => {
          Accept => "application/json"
        }
        auth => {
          user => "${opnsense_api_key}"
          password => "${opnsense_api_secret}"
        }
      }
    }
    request_timeout => 5
    schedule => { every => "5s" }
    codec => "json"
    type => "opnsense_interface_metrics"
    tags => ["metrics", "opnsense", "interface"]
  }
}
