name: Sync Semaphore Templates

on:
  push:
    branches:
      - main
    paths:
      - 'ansible/playbooks/*.yml'
      - 'ansible/sync-semaphore.sh'

jobs:
  sync:
    # Use self-hosted runner on your network that can access Semaphore
    runs-on: self-hosted
    # Alternative: Use ubuntu-latest if Semaphore is publicly accessible
    # runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install jq (if not already installed)
        run: |
          if ! command -v jq &> /dev/null; then
            sudo apt-get update && sudo apt-get install -y jq
          fi

      - name: Sync templates to Semaphore
        env:
          SEMAPHORE_TOKEN: ${{ secrets.SEMAPHORE_TOKEN }}
        run: |
          cd ansible
          chmod +x sync-semaphore.sh
          ./sync-semaphore.sh

