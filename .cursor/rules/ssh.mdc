---
description: SSH access patterns using sshpiper routing and direct IP access
glob:
alwaysApply: true
---

# SSH / Host Access Rules

## Proxy Container Access

The proxy container (`proxy.home.goodkind.io`) is special and has two SSH entry points:

1. **Port 22 (SSHPiper)**: Public-facing. Routes traffic to _other_ containers based on username.
   - `ssh user@ssh.home.goodkind.io` -> routes to `user` on backend container.
2. **Port 2222 (OpenSSH)**: Admin-facing. Direct access to the proxy container itself.
   - `ssh -p 2222 root@3d06:bad:b01::110` -> routes to `root` on the proxy container.

### Proxy Shortcut

To access the proxy container itself via the public port (SSHPiper), use the `@proxy` suffix (if configured):

```bash
ssh root@proxy@ssh.home.goodkind.io
# OR if configured in ~/.ssh/config:
ssh root@proxy
```

This matches the regex `^(.+)@proxy` in `sshpiperd.yaml` and routes to `127.0.0.1:2222`.

## Primary Method: SSHPiper Routing

All `*.ssh.home.goodkind.io` DNS points to `3d06:bad:b01::110` (proxy VM) where sshpiper routes by username:

```bash
ssh adguard@ssh.home.goodkind.io    # → routes to root@adguard-container-ip
ssh pdns@ssh.home.goodkind.io       # → routes to root@pdns-container-ip
ssh mwan@ssh.home.goodkind.io       # → routes to root@mwan-container-ip
```

**Pattern**: `ssh <short-hostname>@ssh.home.goodkind.io`

The short hostname is extracted from the full container name (e.g., `adguard` from `adguard.home.goodkind.io`).

## Direct IP Access (Bypass SSHPiper)

When sshpiper is unavailable or for troubleshooting, use IPs directly (prefer IPv6):

```bash
ssh root@<ipv6-address>    # ✅ Preferred (e.g. ssh root@3d06:bad:b01::107)
```

### Finding Container IPs

If the IP is unknown, look it up via Proxmox:

```bash
# 1. SSH into Proxmox host
ssh root@3d06:bad:b01::254

# 2. Find the container/VM by name
pct list | grep -i <name>    # for containers
qm list | grep -i <name>     # for VMs

# 3. Get the IP address (Look for inet6 first!)
pct exec <VMID> -- ip addr show eth0           # for containers
qm guest cmd <VMID> network-get-interfaces     # for VMs

# 4. SSH directly to the IP (Prefer IPv6)
ssh root@<ipv6-address>
```

## Jump Host Access (Last Resort)

If direct IP access fails, use jump hosts:

```bash
# Via OPNsense
ssh agoodkind@3d06:bad:b01::1
# then from there:
ssh root@3d06:bad:b01::254    # to Proxmox
ssh root@<container-ip>   # to target container
```

## Known Infrastructure IPs

- **Proxy VM (sshpiper)**: `3d06:bad:b01::110` - sshd on port 2222, sshpiper on port 22
- **OPNsense**: `3d06:bad:b01::1` - SSH user: `agoodkind` (use `sudo` for privileged tasks)
- **Proxmox host**: `3d06:bad:b01::254` - SSH user: `root`
- **Ansible container**: `3d06:bad:b01::107` (CT 107) - has `PROXMOX_API_TOKEN` set

## Direct Access to Proxy VM

To access the proxy VM itself (bypassing sshpiper):

```bash
ssh -p 2222 root@3d06:bad:b01::110    # sshd on port 2222
```

## Diagnostics-only SSH Options

Disable strict host key checking for automation/diagnostics:

```bash
ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@<ip>
```
