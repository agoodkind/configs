---
# Traefik Configuration Variables
# Override these in your own environment or use ansible-vault for sensitive values

# SSH Configuration
# Port 22: SSHPiper (routes by username)
# Port 2222: Direct sshd (for Ansible root access)
ansible_port: 2222

# Container hostname
traefik_hostname: proxy.home.goodkind.io

# Stable MAC address for DHCP reservations (KEA: hostname "proxy")
# IPv4 reservation: 10.250.0.10 -> BC:24:11:1D:2C:0F
traefik_mac_address: "bc:24:11:1d:2c:0f"

# Domain configuration
# ingress_domain: client-facing URLs in Traefik route rules (what users access)
# upstream_domain: backend service URLs in loadBalancer targets
#   (where services actually run)
traefik_ingress_domain: "home.goodkind.io"
traefik_upstream_domain: "home.goodkind.io"

# ACME/Let's Encrypt configuration
traefik_acme_email: "alex@goodkind.io"

# ACME DNS challenge provider
# - cloudflare: uses CF_DNS_API_TOKEN
# - rfc2136: uses RFC2136_* (nsupdate/TSIG)
traefik_acme_dns_provider: >-
  {{ lookup('env', 'TRAEFIK_ACME_DNS_PROVIDER', default='cloudflare') }}

# DNS Challenge Configuration
# For RFC2136 (BIND/nsupdate with TSIG):
# Set TRAEFIK_RFC2136_* environment variables in Semaphore
traefik_rfc2136_nameserver: >-
  {{ lookup('env', 'TRAEFIK_RFC2136_NAMESERVER',
     default='[3d06:bad:b01::6]:53') }}
traefik_rfc2136_tsig_algorithm: >-
  {{ lookup('env', 'TRAEFIK_RFC2136_TSIG_ALGORITHM',
     default='hmac-sha256.') }}
traefik_rfc2136_tsig_key: >-
  {{ lookup('env', 'TRAEFIK_RFC2136_TSIG_KEY', default='') }}
traefik_rfc2136_tsig_secret: >-
  {{ lookup('env', 'TRAEFIK_RFC2136_TSIG_SECRET', default='') }}

# Cloudflare API token
# Traefik expects CF_DNS_API_TOKEN. Support common env var names.
cloudflare_api_token: >-
  {{ lookup('env', 'CLOUDFLARE_API_TOKEN',
     default=lookup('env', 'CF_DNS_API_TOKEN',
     default=lookup('env', 'CLOUDFLARE_API_KEY',
     default=vault_cloudflare_api_token))) }}

# Traefik Dashboard Authentication
# Set TRAEFIK_DASHBOARD_USER and TRAEFIK_DASHBOARD_PASS environment variables
traefik_dashboard_user: "{{ lookup('env', 'TRAEFIK_DASHBOARD_USER', default='') }}"
traefik_dashboard_pass: "{{ lookup('env', 'TRAEFIK_DASHBOARD_PASS', default='') }}"

# Cloudflare IP ranges for trusted proxies (X-Forwarded-For)
# Fetched dynamically in the playbook from Cloudflare's official IP list
# https://www.cloudflare.com/ips/

# Traefik version
traefik_version: "3.0.0"

# Directory configuration
traefik_user: traefik
traefik_group: traefik
traefik_config_dir: /etc/traefik
traefik_log_dir: /var/log/traefik
repo_root: /usr/share/configs

# Container login directory (prep-guests.yml)
login_dir: /etc/traefik

# SSHPiper configuration
# Version is auto-detected from GitHub latest release
# You can override by setting sshpiper_version: "x.y.z" if needed
sshpiper_user: sshpiper
sshpiper_group: sshpiper
sshpiper_config_dir: /etc/sshpiper

cloudflared_token_content: "{{ vault_cloudflared_tunnel_token }}"
# Ansible SSH configuration
# Ansible connects as root@<host>:22
# Before sshpiper: connects directly to sshd on port 22
# After sshpiper: sshpiper rejects "root" user (no route), must use port 2222
#
# After initial deployment, uncomment to use direct sshd access:
# ansible_port: 2222
#
# Manual SSH access patterns after deployment:
#   ssh -p 2222 root@proxy.home.goodkind.io  → direct sshd
#   ssh proxy@home.goodkind.io               → sshpiper route to localhost:2222 as root
#   ssh adguard@home.goodkind.io             → sshpiper route to adguard container
