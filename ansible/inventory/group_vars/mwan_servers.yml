---
# MWAN (Multi-WAN) Configuration Variables

# VM hostname
mwan_hostname: mwanold.home.goodkind.io
# Management interface uses DHCP - IP assigned by KEA and registered in DNS automatically
# mwan_mgmt_ip_config can be overridden for static IP if needed:
# mwan_mgmt_ip_config: "ip=10.250.0.134/24,gw=10.250.0.1,ip6=3d06:bad:b01::86/64,gw6=3d06:bad:b01::1"

# DNS configuration (IPv6 first) - use OPNsense as DNS
mwan_dns_domain: "home.goodkind.io"
mwan_dns_servers: "3d06:bad:b01::1 10.250.0.1"

# Proxmox bridge names
mwan_mgmt_bridge: vmbr0 # Management network for SSH access
mwan_bridge_name: mwanbr # mwan <-> OPNsense internal link

# PCI Passthrough devices
# X710 VF for AT&T 802.1X authentication (created on Proxmox host via x710-vf-setup.service)
pci_x710_vf: "02:02.0"
# Webpass I226-V NIC (full passthrough to avoid MAC issues)
pci_webpass_nic: "06:00.0"

# Interface names - hardcoded
mwan_mgmt_iface: "eth0"
mwan_att_iface: "ens16"
mwan_webpass_iface: "ens17"
mwan_internal_iface: "ens19"

# AT&T 802.1X authentication (via X710 VF passthrough)
mwan_att_vlan_id: 3242
mwan_att_eap_identity: "D0:FC:D0:7C:85:30"
mwan_att_mac: "D0:FC:D0:7C:85:30" # MAC for both ens16 and ens16.3242
# Certificates must be manually uploaded to /etc/wpa_supplicant/ on mwan VM
# Extract from OPNsense:
#   scp agoodkind@router:/conf/opnatt/wpa/*.pem root@mwan.home.goodkind.io:/etc/wpa_supplicant/
#   ssh root@mwan.home.goodkind.io "chmod 600 /etc/wpa_supplicant/*.pem"

# Webpass identity spoofing (CRITICAL - must match current OPNsense)
# The I226-V NIC has wrong hardware MAC, so we MUST spoof it
# DUID format: 00:01:00:01:<timestamp>:<mac_address>
# MAC extracted from DUID: 00:e2:69:66:8b:5a
mwan_webpass_duid: "00:01:00:01:2f:aa:b6:c3:00:e2:69:66:8b:5a"
mwan_webpass_mac: "00:e2:69:66:8b:5a" # MAC registered with Webpass

# Webpass static IPv4 (Google Fiber)
# Network: 136.25.91.240/29
# Gateway: 136.25.91.241
# Usable: 136.25.91.242 - 136.25.91.246
mwan_webpass_ipv4: "136.25.91.242/29"
mwan_webpass_gateway: "136.25.91.241"

# Internal link (to OPNsense) addressing
mwan_internal_ipv4: "10.250.250.1/29"
mwan_internal_ipv6: "3d06:bad:b01:fe::1/64"

# Internal prefix for NPT
mwan_internal_prefix: "3d06:bad:b01::/56"

# Static IP mappings (1:1 NAT)
mwan_static_mappings:
  att:
    - { internal: "10.250.250.2", external: "104.57.226.193" }
    - { internal: "10.250.250.3", external: "104.57.226.194" }
    - { internal: "10.250.250.4", external: "104.57.226.195" }
    - { internal: "10.250.250.5", external: "104.57.226.196" }
    - { internal: "10.250.250.6", external: "104.57.226.197" }
  webpass:
    # Note: .242 is also interface IP (dual-purpose)
    - { internal: "10.250.250.2", external: "136.25.91.242" }
    - { internal: "10.250.250.3", external: "136.25.91.243" }
    - { internal: "10.250.250.4", external: "136.25.91.244" }
    - { internal: "10.250.250.5", external: "136.25.91.245" }
    - { internal: "10.250.250.6", external: "136.25.91.246" }

# Health check configuration
mwan_health_checks:
  att:
    enabled: true
    ping_count: 3
    success_threshold: 2
    check_interval: 10
    failure_threshold: 2
    recovery_threshold: 2
    targets:
      - "1.1.1.1" # Cloudflare
      - "8.8.8.8" # Google
  webpass:
    enabled: true
    ping_count: 3
    success_threshold: 2
    check_interval: 10
    failure_threshold: 2
    recovery_threshold: 2
    targets:
      - "1.1.1.1"
      - "8.8.8.8"
  # monkeybrains:
  #   enabled: false # Enable for Phase 3
  #   ping_count: 5
  #   success_threshold: 1 # Lax - it's lossy
  #   check_interval: 30
  #   failure_threshold: 5
  #   recovery_threshold: 3
  #   targets:
  #     - "1.1.1.1"
  #     - "8.8.8.8"

# Latency-sensitive services pinned to AT&T
# Add destination IPs/subnets here
# mwan_att_pinned_dests:
#   - "8.8.8.8/32" # Example - Google DNS for testing
# Add Zoom, Google Meet, WiFi Calling ranges here

# Email notifications (optional)
mwan_email_enabled: true
mwan_email_recipient: "alex@goodkind.io"
mwan_email_script: "/opt/scripts/send-email"
