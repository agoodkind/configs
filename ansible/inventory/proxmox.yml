plugin: community.proxmox.proxmox
url: https://10.250.0.254:8006
user: ansible@pam
token_id: ansible-token
token_secret: >-
  {{ (lookup('ansible.builtin.unvault', 'inventory/group_vars/all/vault.yml') | from_yaml).vault_proxmox_token_secret }}
validate_certs: false
want_facts: true
# Include stopped guests too so playbooks can start them (e.g. prep-guests).
# (We rely on best-effort start + wait_for_connection to handle boot time.)
compose:
  ansible_host: (proxmox_ipconfig0.ip | default(proxmox_net0.ip) | ansible.utils.ipaddr('address'))
  ansible_proxmox_host: proxmox_node
  ansible_proxmox_vmid: proxmox_vmid
keyed_groups:
  - key: proxmox_tags_parsed
    separator: ""
    prefix: tag
groups:
  proxmox: true
  ansible_servers: "'ansible' in (proxmox_tags_parsed or [])"
  powerdns_servers: "'powerdns' in (proxmox_tags_parsed or [])"
  proxy_servers: "'traefik' in (proxmox_tags_parsed or [])"
  mwan_servers: "'mwan' in (proxmox_tags_parsed or [])"
  adguard_servers: "'adguard' in (proxmox_tags_parsed or [])"
  nanomdm_servers: "'nanomdm' in (proxmox_tags_parsed or [])"
  proxmox_all_lxc: "proxmox_type == 'lxc'"
  proxmox_all_qemu: "proxmox_type == 'qemu'"
