# Webpass WAN Interface
# Generated by Ansible
# I226-V NIC passthrough (igc driver) with MAC spoofing

[Match]
Name=enwebpass0

[Network]
# Static IPv4 configuration
Address={{ mwan_webpass_ipv4 }}
# DHCPv6 for prefix delegation
DHCP=ipv6
IPv6AcceptRA=yes
# Needed for policy routing
IPForward=yes

[DHCPv6]
# CRITICAL: Preserve Webpass DUID - changing this breaks service
DUIDType=link-layer-time
# Strip leading 00:01 (type bytes) from full DUID
DUIDRawData={{ mwan_webpass_duid | regex_replace('^00:01:', '') }}
# Request /56 prefix delegation
PrefixDelegationHint=::/56

[Route]
# Default route with metric to avoid conflict with management interface
Gateway={{ mwan_webpass_gateway }}
Metric=10

[Route]
# Default route in webpass routing table for policy routing
Gateway={{ mwan_webpass_gateway }}
Table=webpass

[RoutingPolicyRule]
# Route traffic FROM webpass IP via webpass table
From={{ mwan_webpass_ipv4 | regex_replace('/.*$', '') }}
Table=webpass
Priority=200

