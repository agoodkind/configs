# dhcpcd configuration for mwan
# Generated by Ansible

# Set DUID - CRITICAL for Webpass identity preservation
duid {{ mwan_webpass_duid }}

# Allow users of this group to interact with dhcpcd via the control socket
#controlgroup wheel

# Inform the DHCP server of our hostname for DDNS
hostname

# Use the hardware address of the interface for the Client ID
#clientid

# Persist interface configuration when dhcpcd exits
persistent

# Rapid commit support
option rapid_commit

# A list of options to request from the DHCP server
option domain_name_servers, domain_name, domain_search, host_name
option classless_static_routes
option interface_mtu

# Respect the network MTU
option interface_mtu

# Most distributions have NTP support
#option ntp_servers

# A ServerID is required by RFC2131
require dhcp_server_identifier

# Generate SLAAC address using the Hardware Address of the interface
#slaac hwaddr

# OR generate Stable Private IPv6 Addresses based from the DUID
slaac private

# Management interface - configured by cloud-init with static IP
# Don't let dhcpcd manage it
interface {{ mwan_mgmt_iface }}
    nogateway
    noipv4
    noipv6

# Static IP for internal interface (to OPNsense)
interface {{ mwan_internal_iface }}
    noipv4
    noipv6rs
    noipv6

# AT&T interface - DHCPv4 + DHCPv6-PD
# Note: VLAN 3242 handled by Proxmox host, we receive plain traffic
interface {{ mwan_att_iface }}
    ipv4
    ipv6rs
    ia_na 1
    ia_pd 2/::/60 {{ mwan_internal_iface }}/0

# Webpass interface - DHCPv4 + DHCPv6-PD, NO SLAAC
interface {{ mwan_webpass_iface }}
    ipv4
    noipv6rs  # Don't accept router advertisements (prevents SLAAC)
    ipv6only  # DHCPv6 only
    ia_na 3
    ia_pd 4/::/56 {{ mwan_internal_iface }}/0

{% if mwan_health_checks.monkeybrains.enabled | default(false) %}
# Monkeybrains interface - DHCPv4 + DHCPv6-PD
interface {{ mwan_monkeybrains_iface }}
    ipv4
    noipv6rs
    ipv6only
    ia_na 5
    ia_pd 6/::/56 {{ mwan_internal_iface }}/0
{% endif %}

