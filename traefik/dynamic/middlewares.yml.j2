# Traefik Middlewares
# Managed by Git - configs repo

http:
  middlewares:
    # Security Headers
    secure-headers:
      headers:
        sslRedirect: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        customFrameOptionsValue: "SAMEORIGIN"
        customResponseHeaders:
          X-Robots-Tag: "none,noarchive,nosnippet,notranslate,noimageindex"
          Server: ""

    # Dashboard Authentication
    # Generate with: htpasswd -nb admin password
    # Default: admin / changeme123
    dashboard-auth:
      basicAuth:
        users:
          - "admin:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/"

    # IP Whitelist for Internal Services Only
    # Use this for services that should only be accessible from your internal network
    internal-only:
      ipWhiteList:
        sourceRange:
          - "127.0.0.1/32"
          - "10.250.0.0/24"
          - "::1/128"                    # IPv6 localhost
          - "3d06:bad:b01:0::/64"          # IPv6 private network

    # Cloudflare IP Whitelist - Only allow Cloudflare proxied traffic
    # This ensures all public traffic comes through Cloudflare
    # Updated automatically from: https://www.cloudflare.com/ips/
    cloudflare-only:
      ipWhiteList:
        sourceRange:
          # Cloudflare IPv4
          - "173.245.48.0/20"
          - "103.21.244.0/22"
          - "103.22.200.0/22"
          - "103.31.4.0/22"
          - "141.101.64.0/18"
          - "108.162.192.0/18"
          - "190.93.240.0/20"
          - "188.114.96.0/20"
          - "197.234.240.0/22"
          - "198.41.128.0/17"
          - "162.158.0.0/15"
          - "104.16.0.0/13"
          - "104.24.0.0/14"
          - "172.64.0.0/13"
          - "131.0.72.0/22"
          # Cloudflare IPv6 (prioritized)
          - "2400:cb00::/32"
          - "2606:4700::/32"
          - "2803:f800::/32"
          - "2405:b500::/32"
          - "2405:8100::/32"
          - "2a06:98c0::/29"
          - "2c0f:f248::/32"

    # Rate Limiting
    rate-limit:
      rateLimit:
        average: 100
        burst: 50
        period: 1s

    # Compression
    compress:
      compress: {}
