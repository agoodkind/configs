#!/bin/sh
# Generated by Ansible
#
# MWAN runtime environment for non-templated scripts and units.
# This file is sourced by scripts (POSIX-ish) and read by systemd units.
#
# Keep values shell-safe (no unescaped newlines).

# Debug logging
MWAN_DEBUG_LOGGING={{ mwan_debug_logging | default(false) | ternary('1','0') }}
MWAN_DEBUG_LOG=/var/log/mwan-debug.log
MWAN_TRACE_FILE=/run/mwan-trace-id

# Interface names
MWAN_MGMT_IFACE={{ mwan_mgmt_iface }}
MWAN_ATT_IFACE={{ mwan_att_iface }}
MWAN_ATT_VLAN_ID={{ mwan_att_vlan_id }}
MWAN_ATT_VLAN_IFACE={{ mwan_att_iface }}.{{ mwan_att_vlan_id }}
MWAN_WEBPASS_IFACE={{ mwan_webpass_iface }}
MWAN_MONKEYBRAINS_IFACE={{ mwan_monkeybrains_iface }}
MWAN_INTERNAL_IFACE={{ mwan_internal_iface }}

# Routing table IDs
MWAN_RT_ATT={{ mwan_rt_tables.att }}
MWAN_RT_WEBPASS={{ mwan_rt_tables.webpass }}
MWAN_RT_MONKEYBRAINS={{ mwan_rt_tables.monkeybrains }}
MWAN_RT_CLOUDFLARED={{ mwan_rt_tables.cloudflared }}

# Internal link
MWAN_INTERNAL_NET=10.250.250.0/29
MWAN_INTERNAL_PREFIX={{ mwan_internal_prefix }}
MWAN_MWANBR_EDGE_IPV6={{ mwan_mwanbr_edge_ipv6 }}
MWAN_OPNSENSE_WAN_LL={{ mwan_opnsense_wan_ll }}
MWAN_OPNSENSE_EDGE_IPV6={{ mwan_opnsense_edge_ipv6 }}

# NPT targets (per-WAN /60s)
MWAN_NPT_ATT_PREFIX={{ mwan_npt_att_prefix }}
MWAN_NPT_WEBPASS_PREFIX={{ mwan_npt_webpass_prefix }}
MWAN_NPT_MONKEYBRAINS_PREFIX={{ mwan_npt_monkeybrains_prefix | default('') }}

# Delegated prefixes (reference/visibility)
MWAN_PD_ATT_PREFIX={{ mwan_att_pd_prefix | default('') }}
MWAN_PD_WEBPASS_PREFIX={{ mwan_webpass_pd_prefix | default('') }}
MWAN_PD_MONKEYBRAINS_PREFIX={{ mwan_monkeybrains_pd_prefix | default('') }}

# Webpass IPv4 (used for policy routing source pin)
MWAN_WEBPASS_IPV4_ADDR={{ mwan_webpass_ipv4_addr }}

# AT&T pinned destinations (nft set seed + FQDN expansion)
MWAN_ATT_PINNED_V4_SEED_CIDRS="{{ (mwan_att_pinned_v4_seed_cidrs | default([])) | join(' ') }}"
MWAN_ATT_PINNED_V4_FQDNS="{{ (mwan_att_pinned_v4_fqdns | default([])) | join(' ') }}"
MWAN_ZOOM_IPRANGES_URL="{{ mwan_zoom_ipranges_url | default('') }}"

# Health checks (mwan-health /usr/local/bin/health-check.sh)
MWAN_HEALTH_ATT_PING_COUNT={{ mwan_health_checks.att.ping_count | default(3) }}
MWAN_HEALTH_ATT_SUCCESS_THRESHOLD={{ mwan_health_checks.att.success_threshold | default(2) }}
MWAN_HEALTH_ATT_CHECK_INTERVAL={{ mwan_health_checks.att.check_interval | default(10) }}
MWAN_HEALTH_ATT_FAILURE_THRESHOLD={{ mwan_health_checks.att.failure_threshold | default(2) }}
MWAN_HEALTH_ATT_RECOVERY_THRESHOLD={{ mwan_health_checks.att.recovery_threshold | default(2) }}
MWAN_HEALTH_ATT_TARGETS_V4="{{ (mwan_health_checks.att.targets_v4 | default([])) | join(' ') }}"
MWAN_HEALTH_ATT_TARGETS_V6="{{ (mwan_health_checks.att.targets_v6 | default([])) | join(' ') }}"
MWAN_HEALTH_ATT_HTTP_TARGETS="{{ (mwan_health_checks.att.http_targets | default([])) | join(' ') }}"

MWAN_HEALTH_WEBPASS_PING_COUNT={{ mwan_health_checks.webpass.ping_count | default(3) }}
MWAN_HEALTH_WEBPASS_SUCCESS_THRESHOLD={{ mwan_health_checks.webpass.success_threshold | default(2) }}
MWAN_HEALTH_WEBPASS_CHECK_INTERVAL={{ mwan_health_checks.webpass.check_interval | default(10) }}
MWAN_HEALTH_WEBPASS_FAILURE_THRESHOLD={{ mwan_health_checks.webpass.failure_threshold | default(2) }}
MWAN_HEALTH_WEBPASS_RECOVERY_THRESHOLD={{ mwan_health_checks.webpass.recovery_threshold | default(2) }}
MWAN_HEALTH_WEBPASS_TARGETS_V4="{{ (mwan_health_checks.webpass.targets_v4 | default([])) | join(' ') }}"
MWAN_HEALTH_WEBPASS_TARGETS_V6="{{ (mwan_health_checks.webpass.targets_v6 | default([])) | join(' ') }}"
MWAN_HEALTH_WEBPASS_HTTP_TARGETS="{{ (mwan_health_checks.webpass.http_targets | default([])) | join(' ') }}"

MWAN_HEALTH_MONKEYBRAINS_PING_COUNT={{ mwan_health_checks.monkeybrains.ping_count | default(5) }}
MWAN_HEALTH_MONKEYBRAINS_SUCCESS_THRESHOLD={{ mwan_health_checks.monkeybrains.success_threshold | default(1) }}
MWAN_HEALTH_MONKEYBRAINS_CHECK_INTERVAL={{ mwan_health_checks.monkeybrains.check_interval | default(30) }}
MWAN_HEALTH_MONKEYBRAINS_FAILURE_THRESHOLD={{ mwan_health_checks.monkeybrains.failure_threshold | default(5) }}
MWAN_HEALTH_MONKEYBRAINS_RECOVERY_THRESHOLD={{ mwan_health_checks.monkeybrains.recovery_threshold | default(3) }}
MWAN_HEALTH_MONKEYBRAINS_TARGETS_V4="{{ (mwan_health_checks.monkeybrains.targets_v4 | default([])) | join(' ') }}"
MWAN_HEALTH_MONKEYBRAINS_TARGETS_V6="{{ (mwan_health_checks.monkeybrains.targets_v6 | default([])) | join(' ') }}"
MWAN_HEALTH_MONKEYBRAINS_HTTP_TARGETS="{{ (mwan_health_checks.monkeybrains.http_targets | default([])) | join(' ') }}"

