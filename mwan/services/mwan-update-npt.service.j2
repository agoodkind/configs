[Unit]
Description=Reapply MWAN IPv6 NPT rules at boot
After=network-online.target nftables.service
Wants=network-online.target

[Service]
Type=oneshot
# Wait for WAN interfaces to exist (avoid running before VLAN/NICs appear)
ExecStartPre=/bin/bash -c 'for i in $(seq 1 60); do [ -d "/sys/class/net/{{ mwan_att_iface }}.{{ mwan_att_vlan_id }}" ] && [ -d "/sys/class/net/{{ mwan_webpass_iface }}" ] && exit 0; sleep 1; done; exit 0'
ExecStart=/usr/local/bin/update-npt.sh {{ mwan_att_iface }}.{{ mwan_att_vlan_id }} {{ mwan_npt_att_prefix }}
ExecStart=/usr/local/bin/update-npt.sh {{ mwan_webpass_iface }} {{ mwan_npt_webpass_prefix }}

[Install]
WantedBy=multi-user.target
