# AT&T VLAN Interface
# Generated by Ansible
# X710 VF passthrough, VLAN 3242
# AT&T assigns a IPv4 address & gateway via DHCP
# and then the static IPv4s we were given can be routed through it.
#
# AT&T Assigns a /60 prefix via DHCPv6-PD
#
# IMPORTANT: AT&T will not respond to DHCP until after 802.1X authentication
# on the parent interface (enatt0). The VLAN interface is created declaratively
# by systemd-networkd, but DHCP is triggered by bringup-att-vlan.service
# after authentication succeeds.

[Match]
Name={{ mwan_att_iface }}.{{ mwan_att_vlan_id }}

[Network]
DHCP=yes
IPv6AcceptRA=yes
# Needed for policy routing
IPv4Forwarding=yes
IPv6Forwarding=yes

[DHCPv4]
# DHCPv4 configuration

[DHCPv6]
UseDelegatedPrefix=yes
PrefixDelegationHint=::/60
DUIDType=vendor
DUIDRawData={{ mwan_att_duid_raw_data }}
WithoutRA=solicit

[IPv6PrefixDelegation]
RouterLifetimeSec=1800

# Note on Routing Policy:
# Unlike the Webpass interface (which has static IPs), this AT&T interface
# obtains its IP and Gateway dynamically via DHCP/RA.
#
# We CANNOT define static [Route] or [RoutingPolicyRule] sections here because
# we don't know the Gateway or Source IP at template time.
#
# Instead, we rely on the networkd-dispatcher script (50-update-routes.sh) to:
# 1. Detect the dynamic Gateway/IP after the link comes up.
# 2. Add the default route to table {{ mwan_rt_tables.att }}.
# 3. Add the ip rules (fwmark/from) for policy routing.
