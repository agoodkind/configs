#!/bin/bash
# Create a trace ID for this boot and persist it.
# Generated by Ansible

set -euo pipefail

install -d -m 0755 /run /var/lib/mwan

boot_id="$(cat /proc/sys/kernel/random/boot_id 2>/dev/null | cut -c1-8 || true)"
ts="$(date +%Y%m%d-%H%M%S)"
tid="${ts}-boot-${boot_id:-unknown}"

printf '%s\n' "$tid" | tee /run/mwan-trace-id /var/lib/mwan/trace-id >/dev/null
logger -t mwan-trace-boot "traceId=$tid"
